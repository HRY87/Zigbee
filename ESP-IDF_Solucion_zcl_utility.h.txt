Estructura general de un proyecto ESP-IDF
ğŸ“‚ mi_proyecto/
â”œâ”€â”€ ğŸ“ main/
â”‚   â”œâ”€â”€ main.c
â”‚   â””â”€â”€ CMakeLists.txt        <-- CMake del componente principal
â”‚
â”œâ”€â”€ ğŸ“ components/             <-- Componentes personalizados
â”‚   â””â”€â”€ ğŸ“ zcl_utility/
â”‚       â”œâ”€â”€ ğŸ“ include/
â”‚       â”‚   â””â”€â”€ zcl_utility.h
â”‚       â”œâ”€â”€ ğŸ“ src/
â”‚       â”‚   â””â”€â”€ zcl_utility.c
â”‚       â””â”€â”€ CMakeLists.txt    <-- CMake del componente zcl_utility
â”‚
â”œâ”€â”€ ğŸ“ managed_components/     <-- LibrerÃ­as descargadas con idf.py add-dependency
â”‚   â””â”€â”€ espressif__esp-zigbee-lib/
â”‚       â”œâ”€â”€ include/
â”‚       â””â”€â”€ lib/
â”‚
â”œâ”€â”€ CMakeLists.txt             <-- CMake raÃ­z del proyecto
â”œâ”€â”€ sdkconfig
â””â”€â”€ idf.py                     <-- Herramienta de build de ESP-IDF

Hay mas archivos y carpetas pero los importantes son estos a la hora de programar cÃ³digo

1.CMakeLists.txt (raÃ­z del proyecto)

Ubicado en la carpeta principal (mi_proyecto/).

Ejemplo:

# Establece la versiÃ³n mÃ­nima requerida de CMake
cmake_minimum_required(VERSION 3.16.0)

# Indica el directorio donde estÃ¡ el ESP-IDF
include($ENV{IDF_PATH}/tools/cmake/project.cmake)

# Define el nombre del proyecto (usa el mismo que el folder raÃ­z)
project(Zigbee_Cliente)

Este archivo es el punto de entrada de la configuraciÃ³n del proyecto.
Llama al sistema de build de ESP-IDF y busca los componentes.

2.CMakeLists.txt (componente principal main/)

Ejemplo:

idf_component_register(
    SRC_DIRS  "."
    INCLUDE_DIRS "."
)


Declara el componente principal.

3.CMakeLists.txt (componente zcl_utility/) (Este generaba problemas porque esta en la carpeta examples y no tenia CmakeLists)

Ejemplo: (Este funciono para detectarlo)

idf_component_register(
    SRC_DIRS "src"
    INCLUDE_DIRS "include"
    REQUIRES espressif__esp-zigbee-lib
)

Este CMake declara el componente zcl_utility.
REQUIRES esp-zigbee-lib le da acceso a las cabeceras Zigbee ubicadas en managed_components.


Flujo de detecciÃ³n de componentes

Siempre que se haga alguna modificaciÃ³n sobre los CMakeLists hay que ejecutar el siguiente comando antes de compilar, sino el IDE no considera los cambios

Esto se escribe en una terminal ESP-IDF

idf.py reconfigure


ESP-IDF busca automÃ¡ticamente todos los CMakeLists.txt dentro de:

main/

components/

managed_components/

y los registra como componentes del proyecto.
Cada uno puede depender de otros mediante REQUIRES, formando un grafo de dependencias que CMake resuelve automÃ¡ticamente.

Una vez que termine si se hizo bien no hay mas errores de IncludePath


